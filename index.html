<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pelvic Health Outcome Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .lucide { width: 24px; height: 24px; stroke: currentColor; stroke-width: 2; fill: none; stroke-linecap: round; stroke-linejoin: round; }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-50 to-purple-100 min-h-screen p-6">
    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center gap-3">
                    <svg class="lucide text-pink-600" viewBox="0 0 24 24">
                        <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.29 1.51 4.04 3 5.5Z"/>
                    </svg>
                    <h1 class="text-3xl font-bold text-gray-800">Pelvic Health Outcome Calculator</h1>
                </div>
                <button onclick="resetCalculator()" class="flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                    <svg class="lucide" viewBox="0 0 24 24">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                    </svg>
                    Reset
                </button>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-6">
                    <div>
                        <label class="block text-lg font-semibold text-gray-700 mb-3">
                            Select Assessment Tool
                        </label>
                        <select id="testSelector" onchange="handleTestChange()" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500 focus:outline-none text-lg">
                            <option value="">Choose an assessment...</option>
                            <option value="APFQ">Australian Pelvic Floor Questionnaire</option>
                            <option value="PAC-SYM">Patient Assessment of Constipation Symptoms</option>
                            <option value="FIQL">Fecal Incontinence Quality of Life Scale</option>
                            <option value="MENQOL">Menopause-Specific Quality of Life</option>
                            <option value="PFDI">Pelvic Floor Disability Index (PFDI-20)</option>
                            <option value="PGQ">Pelvic Girdle Questionnaire</option>
                            <option value="UIQ">Urinary Incontinence Questionnaire</option>
                            <option value="FSFI6">Female Sexual Function Index - 6 Item</option>
                        </select>
                    </div>

                    <div id="testInfo" style="display: none;" class="bg-pink-50 p-6 rounded-lg">
                        <h3 id="testTitle" class="font-semibold text-pink-800 mb-3"></h3>
                        <div class="space-y-2 text-sm text-pink-700">
                            <p><strong>Questions/Items:</strong> <span id="testQuestions"></span></p>
                            <p><strong>Score Range:</strong> <span id="testRange"></span></p>
                        </div>
                        <div id="testNote" class="mt-4 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400" style="display: none;">
                            <p id="testNoteText" class="text-sm text-blue-800"></p>
                        </div>
                    </div>

                    <div id="calculatorSection" style="display: none;">
                        <div class="flex gap-4 mb-4">
                            <button onclick="setCalculatorMode('direct')" id="directModeBtn" class="flex items-center gap-2 px-4 py-2 rounded-lg transition-colors bg-gray-100 text-gray-700 hover:bg-gray-200">
                                <svg class="lucide" viewBox="0 0 24 24">
                                    <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/>
                                    <path d="M14 2v4a2 2 0 0 0 2 2h4"/>
                                    <line x1="10" x2="16" y1="13" y2="13"/>
                                    <line x1="10" x2="16" y1="17" y2="17"/>
                                    <polyline points="10,9 9,9 8,9"/>
                                </svg>
                                Enter Total
                            </button>
                            <button onclick="setCalculatorMode('calculator')" id="calculatorModeBtn" class="flex items-center gap-2 px-4 py-2 rounded-lg transition-colors bg-gray-100 text-gray-700 hover:bg-gray-200">
                                <svg class="lucide" viewBox="0 0 24 24">
                                    <rect width="16" height="20" x="4" y="2" rx="2" ry="2"/>
                                    <line x1="8" x2="16" y1="6" y2="6"/>
                                    <line x1="8" x2="16" y1="10" y2="10"/>
                                    <line x1="8" x2="16" y1="14" y2="14"/>
                                    <line x1="8" x2="16" y1="18" y2="18"/>
                                </svg>
                                Calculator Mode
                            </button>
                        </div>

                        <div id="directMode">
                            <label class="block text-lg font-semibold text-gray-700 mb-3">
                                Total Score
                            </label>
                            <input type="number" id="totalScore" oninput="calculateResult()" placeholder="Enter total score" step="0.1" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-pink-500 focus:outline-none text-xl text-center font-semibold">
                        </div>

                        <div id="calculatorMode" style="display: none;">
                            <div id="pfdiCalculator" style="display: none;" class="space-y-4">
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-purple-800 mb-2">PFDI-20 Individual Question Scores</h4>
                                    <p class="text-sm text-purple-700 mb-4">
                                        Enter scores for each question (0-4). For each subscale: sum answered items รท number of answered items ร 25 = subscale score.
                                    </p>
                                </div>
                                
                                <div class="bg-white p-4 rounded-lg border">
                                    <h5 class="font-medium text-gray-800 mb-3">POPDI-6: Pelvic Organ Prolapse Distress Inventory</h5>
                                    <div class="grid grid-cols-3 sm:grid-cols-6 gap-3" id="popdiQuestions">
                                        <!-- Questions 1-6 -->
                                    </div>
                                    <div class="mt-2 text-right">
                                        <span class="text-sm font-medium text-gray-600">
                                            Subscale Score: <span id="popdiScore">0.0</span>
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="bg-white p-4 rounded-lg border">
                                    <h5 class="font-medium text-gray-800 mb-3">CRADI-8: Colorectal-Anal Distress Inventory</h5>
                                    <div class="grid grid-cols-4 sm:grid-cols-8 gap-3" id="cradiQuestions">
                                        <!-- Questions 7-14 -->
                                    </div>
                                    <div class="mt-2 text-right">
                                        <span class="text-sm font-medium text-gray-600">
                                            Subscale Score: <span id="cradiScore">0.0</span>
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="bg-white p-4 rounded-lg border">
                                    <h5 class="font-medium text-gray-800 mb-3">UDI-6: Urinary Distress Inventory</h5>
                                    <div class="grid grid-cols-3 sm:grid-cols-6 gap-3" id="udiQuestions">
                                        <!-- Questions 15-20 -->
                                    </div>
                                    <div class="mt-2 text-right">
                                        <span class="text-sm font-medium text-gray-600">
                                            Subscale Score: <span id="udiScore">0.0</span>
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <span class="font-semibold text-green-800">Total PFDI-20 Score:</span>
                                        <span id="pfdiTotalScore" class="text-xl font-bold text-green-800">0.0</span>
                                    </div>
                                </div>
                            </div>

                            <div id="apfqCalculator" style="display: none;" class="space-y-4">
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-purple-800 mb-2">APFQ Individual Question Scores</h4>
                                    <p class="text-sm text-purple-700 mb-4">
                                        Enter scores for each question (0-4). For each domain: sum items รท number of items ร 10 = domain score (0-10).
                                    </p>
                                </div>
                                
                                <div class="bg-white p-4 rounded-lg border">
                                    <h5 class="font-medium text-gray-800 mb-3">Bladder Function (Questions 1-15)</h5>
                                    <div class="grid grid-cols-5 sm:grid-cols-10 gap-2" id="bladderQuestions">
                                        <!-- Questions 1-15 -->
                                    </div>
                                    <div class="mt-2 text-right">
                                        <span class="text-sm font-medium text-gray-600">
                                            Domain Score: <span id="bladderScore">0</span>/45
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="bg-white p-4 rounded-lg border">
                                    <h5 class="font-medium text-gray-800 mb-3">Bowel Function (Questions 16-27)</h5>
                                    <div class="grid grid-cols-4 sm:grid-cols-6 gap-2" id="bowelQuestions">
                                        <!-- Questions 16-27 -->
                                    </div>
                                    <div class="mt-2 text-right">
                                        <span class="text-sm font-medium text-gray-600">
                                            Domain Score: <span id="bowelScore">0</span>/34
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="bg-white p-4 rounded-lg border">
                                    <h5 class="font-medium text-gray-800 mb-3">Prolapse Function (Questions 28-32)</h5>
                                    <div class="grid grid-cols-5 gap-2" id="prolapseQuestions">
                                        <!-- Questions 28-32 -->
                                    </div>
                                    <div class="mt-2 text-right">
                                        <span class="text-sm font-medium text-gray-600">
                                            Domain Score: <span id="prolapseScore">0</span>/15
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="bg-white p-4 rounded-lg border">
                                    <h5 class="font-medium text-gray-800 mb-3">Sexual Function</h5>
                                    <div class="mb-3">
                                        <h6 class="text-sm font-medium text-gray-700 mb-2">Screening Questions (Not scored):</h6>
                                        <div class="grid grid-cols-2 gap-2" id="sexualScreeningQuestions">
                                            <!-- Questions 33-34 -->
                                        </div>
                                    </div>
                                    <div>
                                        <h6 class="text-sm font-medium text-gray-700 mb-2">Scored Questions (35-42):</h6>
                                        <div class="grid grid-cols-4 sm:grid-cols-8 gap-2" id="sexualQuestions">
                                            <!-- Questions 35-42 -->
                                        </div>
                                    </div>
                                    <div class="mt-2 text-right">
                                        <span class="text-sm font-medium text-gray-600">
                                            Domain Score: <span id="sexualScore">0</span>/21
                                        </span>
                                    </div>
                                    <div class="mt-2 text-xs text-gray-500">
                                        <p><strong>Note:</strong> If Q33 indicates "not sexually active", only Q34 and Q42 are required.</p>
                                    </div>
                                </div>
                                
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <span class="font-semibold text-green-800">Total APFQ Score:</span>
                                        <span id="apfqTotalScore" class="text-xl font-bold text-green-800">0/115</span>
                                    </div>
                                </div>
                            </div>

                            <div id="generalCalculator" style="display: none;" class="space-y-4">
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-purple-800 mb-2">Individual Question Scores</h4>
                                    <p class="text-sm text-purple-700 mb-4">
                                        Enter the score for each question/item. The total will be calculated automatically.
                                    </p>
                                </div>
                                
                                <div id="questionInputs" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 max-h-96 overflow-y-auto">
                                    <!-- Question inputs will be generated here -->
                                </div>
                                
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <span class="font-semibold text-green-800">Calculated Total:</span>
                                        <span id="generalTotalScore" class="text-xl font-bold text-green-800">0.0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-6">
                    <div id="resultsSection" style="display: none;" class="bg-gradient-to-br from-green-50 to-emerald-100 p-6 rounded-xl border-2 border-green-200">
                        <div class="flex items-center gap-2 mb-4">
                            <svg class="lucide text-green-800" viewBox="0 0 24 24">
                                <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/>
                                <path d="M14 2v4a2 2 0 0 0 2 2h4"/>
                                <line x1="10" x2="16" y1="13" y2="13"/>
                                <line x1="10" x2="16" y1="17" y2="17"/>
                                <polyline points="10,9 9,9 8,9"/>
                            </svg>
                            <h3 class="text-xl font-bold text-green-800">Results</h3>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="bg-white p-4 rounded-lg">
                                <div class="text-center">
                                    <div id="percentageScore" class="text-3xl font-bold text-gray-800 mb-2">
                                        0%
                                    </div>
                                    <div id="percentageLabel" class="text-lg text-gray-600">
                                        Symptom Severity Level
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white p-4 rounded-lg">
                                <div class="text-center">
                                    <div id="interpretationLevel" class="text-lg font-semibold text-gray-800">
                                        
                                    </div>
                                </div>
                            </div>
                            
                            <div id="subscaleResults" style="display: none;" class="bg-white p-4 rounded-lg">
                                <h4 class="font-medium text-gray-800 mb-3">Subscale Scores</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span>POPDI-6:</span>
                                        <span id="popdiResult" class="font-medium">0.0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>CRADI-8:</span>
                                        <span id="cradiResult" class="font-medium">0.0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>UDI-6:</span>
                                        <span id="udiResult" class="font-medium">0.0</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="domainResults" style="display: none;" class="bg-white p-4 rounded-lg">
                                <h4 class="font-medium text-gray-800 mb-3">Domain Scores</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span>Bladder:</span>
                                        <span id="bladderResult" class="font-medium">0.0/10</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Bowel:</span>
                                        <span id="bowelResult" class="font-medium">0.0/10</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Prolapse:</span>
                                        <span id="prolapseResult" class="font-medium">0.0/10</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Sexual:</span>
                                        <span id="sexualResult" class="font-medium">0.0/10</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="validationError" style="display: none;" class="bg-yellow-50 p-4 rounded-lg border-2 border-yellow-200">
                        <p id="validationMessage" class="text-yellow-800">
                            Please enter a valid score.
                        </p>
                    </div>

                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h3 class="font-semibold text-gray-800 mb-3">Quick Reference</h3>
                        <div id="quickReference" class="text-sm text-gray-600 space-y-2">
                            <p><strong>Minimal Impairment:</strong> 0-20%</p>
                            <p><strong>Mild Impairment:</strong> 21-40%</p>
                            <p><strong>Moderate Impairment:</strong> 41-60%</p>
                            <p><strong>Severe Impairment:</strong> 61-80%</p>
                            <p><strong>Very Severe Impairment:</strong> 81-100%</p>
                        </div>
                        <p class="text-xs text-gray-500 mt-4">
                            * Interpretation may vary by specific assessment tool and clinical context
                        </p>
                    </div>
                </div>
            </div>

            <div class="mt-8 p-4 bg-pink-50 rounded-lg">
                <p class="text-sm text-pink-800">
                    <strong>Note:</strong> This calculator is for educational and clinical reference purposes in pelvic health assessment. 
                    Always refer to the original assessment guidelines and consider clinical context when interpreting results. 
                    These tools should be used by qualified healthcare professionals.
                </p>
            </div>
        </div>
    </div>

    <script>
        const assessmentTools = {
            'APFQ': {
                name: 'Australian Pelvic Floor Questionnaire',
                maxScore: 115, minScore: 0, questions: 42,
                domains: {
                    'Bladder': { questions: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15], name: 'Bladder Function', maxScore: 45 },
                    'Bowel': { questions: [16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27], name: 'Bowel Function', maxScore: 34 },
                    'Prolapse': { questions: [28, 29, 30, 31, 32], name: 'Pelvic Organ Prolapse', maxScore: 15 },
                    'Sexual': { questions: [35, 36, 37, 38, 39, 40, 41, 42], name: 'Sexual Function', maxScore: 21, excludeFromTotal: [33, 34] }
                },
                interpretation: (score) => {
                    const percentage = (score / 115) * 100;
                    let level = '';
                    if (percentage <= 20) level = 'Minimal pelvic floor dysfunction';
                    else if (percentage <= 35) level = 'Mild pelvic floor dysfunction';
                    else if (percentage <= 55) level = 'Moderate pelvic floor dysfunction';
                    else if (percentage <= 75) level = 'Severe pelvic floor dysfunction';
                    else level = 'Very severe pelvic floor dysfunction';
                    return { percentage: percentage.toFixed(1), level };
                }
            },
            'PAC-SYM': {
                name: 'Patient Assessment of Constipation Symptoms',
                maxScore: 4.0, minScore: 0.0, questions: 12,
                interpretation: (score) => {
                    const percentage = (score / 4.0) * 100;
                    let level = '';
                    if (percentage <= 25) level = 'Minimal constipation symptoms';
                    else if (percentage <= 50) level = 'Mild constipation symptoms';
                    else if (percentage <= 75) level = 'Moderate constipation symptoms';
                    else level = 'Severe constipation symptoms';
                    return { percentage: percentage.toFixed(1), level };
                }
            },
            'FIQL': {
                name: 'Fecal Incontinence Quality of Life Scale',
                maxScore: 4.0, minScore: 1.0, questions: 29,
                interpretation: (score) => {
                    const percentage = ((4.0 - score) / 3.0) * 100;
                    let level = '';
                    if (percentage <= 20) level = 'Excellent quality of life';
                    else if (percentage <= 40) level = 'Good quality of life';
                    else if (percentage <= 60) level = 'Fair quality of life';
                    else if (percentage <= 80) level = 'Poor quality of life';
                    else level = 'Very poor quality of life';
                    return { percentage: percentage.toFixed(1), level };
                }
            },
            'MENQOL': {
                name: 'Menopause-Specific Quality of Life',
                maxScore: 8.0, minScore: 1.0, questions: 29,
                interpretation: (score) => {
                    const percentage = ((score - 1.0) / 7.0) * 100;
                    let level = '';
                    if (percentage <= 20) level = 'Minimal menopausal symptoms';
                    else if (percentage <= 40) level = 'Mild menopausal symptoms';
                    else if (percentage <= 60) level = 'Moderate menopausal symptoms';
                    else if (percentage <= 80) level = 'Severe menopausal symptoms';
                    else level = 'Very severe menopausal symptoms';
                    return { percentage: percentage.toFixed(1), level };
                }
            },
            'PFDI': {
                name: 'Pelvic Floor Disability Index (PFDI-20)',
                maxScore: 300, minScore: 0, questions: 20,
                subscales: {
                    'POPDI-6': { questions: [1, 2, 3, 4, 5, 6], name: 'Pelvic Organ Prolapse Distress Inventory' },
                    'CRADI-8': { questions: [7, 8, 9, 10, 11, 12, 13, 14], name: 'Colorectal-Anal Distress Inventory' },
                    'UDI-6': { questions: [15, 16, 17, 18, 19, 20], name: 'Urinary Distress Inventory' }
                },
                interpretation: (score) => {
                    const percentage = (score / 300) * 100;
                    let level = '';
                    if (percentage <= 10) level = 'Minimal pelvic floor disability';
                    else if (percentage <= 30) level = 'Mild pelvic floor disability';
                    else if (percentage <= 50) level = 'Moderate pelvic floor disability';
                    else if (percentage <= 70) level = 'Severe pelvic floor disability';
                    else level = 'Very severe pelvic floor disability';
                    return { percentage: percentage.toFixed(1), level };
                }
            },
            'PGQ': {
                name: 'Pelvic Girdle Questionnaire',
                maxScore: 75, minScore: 25, questions: 25,
                interpretation: (score) => {
                    const percentage = ((score - 25) / 50) * 100;
                    let level = '';
                    if (percentage <= 20) level = 'Minimal pelvic girdle dysfunction';
                    else if (percentage <= 40) level = 'Mild pelvic girdle dysfunction';
                    else if (percentage <= 60) level = 'Moderate pelvic girdle dysfunction';
                    else if (percentage <= 80) level = 'Severe pelvic girdle dysfunction';
                    else level = 'Very severe pelvic girdle dysfunction';
                    return { percentage: percentage.toFixed(1), level };
                }
            },
            'UIQ': {
                name: 'Urinary Incontinence Questionnaire',
                maxScore: 91, minScore: 0, questions: 21,
                interpretation: (score) => {
                    const percentage = (score / 91) * 100;
                    let level = '';
                    if (percentage <= 10) level = 'Minimal urinary incontinence impact';
                    else if (percentage <= 25) level = 'Mild urinary incontinence impact';
                    else if (percentage <= 50) level = 'Moderate urinary incontinence impact';
                    else if (percentage <= 75) level = 'Severe urinary incontinence impact';
                    else level = 'Very severe urinary incontinence impact';
                    return { percentage: percentage.toFixed(1), level };
                }
            },
            'FSFI6': {
                name: 'Female Sexual Function Index - 6 Item',
                maxScore: 30, minScore: 2, questions: 6,
                interpretation: (score) => {
                    let level = '';
                    if (score >= 19) level = 'Normal sexual function - Low risk of sexual dysfunction';
                    else if (score >= 15) level = 'Mild sexual dysfunction - Some areas of concern';
                    else if (score >= 10) level = 'Moderate sexual dysfunction - Significant functional impairment';
                    else level = 'Severe sexual dysfunction - Major functional impairment';
                    const percentage = ((30 - score) / 28) * 100;
                    return { percentage: percentage.toFixed(1), level };
                }
            }
        };

        let selectedTest = '';
        let calculatorMode = 'direct';
        let individualScores = {};
        let currentResult = null;

        function handleTestChange() {
            selectedTest = document.getElementById('testSelector').value;
            
            if (selectedTest) {
                showTestInfo();
                showCalculatorSection();
                updateQuickReference();
            } else {
                hideTestInfo();
                hideCalculatorSection();
                hideResults();
            }
            
            resetScores();
        }

        function showTestInfo() {
            const tool = assessmentTools[selectedTest];
            document.getElementById('testTitle').textContent = tool.name;
            document.getElementById('testQuestions').textContent = tool.questions;
            document.getElementById('testRange').textContent = `${tool.minScore} - ${tool.maxScore}`;
            
            // Show specific notes for certain tests
            const noteElement = document.getElementById('testNote');
            const noteTextElement = document.getElementById('testNoteText');
            
            let noteText = '';
            if (selectedTest === 'PAC-SYM') {
                noteText = '<strong>Scoring Note:</strong> PAC-SYM is scored as a mean (0-4 scale). Items rated: 0=absent, 1=mild, 2=moderate, 3=severe, 4=very severe. Lower scores indicate less constipation symptom severity.';
            } else if (selectedTest === 'FIQL') {
                noteText = '<strong>Scoring Note:</strong> FIQL uses 4 domains (29 items total). Scores are averaged (1-4 scale). Lower scores indicate worse quality of life due to fecal incontinence.';
            } else if (selectedTest === 'MENQOL') {
                noteText = '<strong>Scoring Note:</strong> MENQOL uses a 1-8 scale (1=not experienced, 2=experienced but not bothersome, 3-8=increasing bother). Higher scores indicate more bothersome menopausal symptoms.';
            } else if (selectedTest === 'FSFI6') {
                noteText = '<strong>Scoring Note:</strong> FSFI-6 ranges 2-30. Validated cutoff โค19 indicates likely sexual dysfunction. Higher scores indicate better sexual function.';
            } else if (selectedTest === 'PFDI') {
                noteText = '<strong>Scoring Note:</strong> PFDI-20 consists of 3 subscales: POPDI-6 (Q1-6), CRADI-8 (Q7-14), and UDI-6 (Q15-20). Each question scored 0-4. For each subscale: sum answered items รท number of answered items ร 25. Total = sum of 3 subscales.';
            } else if (selectedTest === 'APFQ') {
                noteText = '<strong>Scoring Note:</strong> APFQ has 4 domains: Bladder (Q1-15, max 45 pts), Bowel (Q16-27, max 34 pts), Prolapse (Q28-32, max 15 pts), Sexual (Q35-42, max 21 pts). Each question scored 0-3. Q33 and Q34 are screening questions not included in scoring. Total score = raw sum of all domains (0-115).';
            } else if (selectedTest === 'UIQ') {
                noteText = '<strong>Scoring Note:</strong> This 21-question assessment covers urinary leakage frequency and severity, protection usage, quality of life impact, and urinary control patterns.';
            }
            
            if (noteText) {
                noteTextElement.innerHTML = noteText;
                noteElement.style.display = 'block';
            } else {
                noteElement.style.display = 'none';
            }
            
            document.getElementById('testInfo').style.display = 'block';
        }

        function hideTestInfo() {
            document.getElementById('testInfo').style.display = 'none';
        }

        function showCalculatorSection() {
            document.getElementById('calculatorSection').style.display = 'block';
            setupCalculatorMode();
        }

        function hideCalculatorSection() {
            document.getElementById('calculatorSection').style.display = 'none';
        }

        function setCalculatorMode(mode) {
            calculatorMode = mode;
            
            // Update button styles
            const directBtn = document.getElementById('directModeBtn');
            const calcBtn = document.getElementById('calculatorModeBtn');
            
            if (mode === 'direct') {
                directBtn.className = 'flex items-center gap-2 px-4 py-2 rounded-lg transition-colors bg-pink-500 text-white';
                calcBtn.className = 'flex items-center gap-2 px-4 py-2 rounded-lg transition-colors bg-gray-100 text-gray-700 hover:bg-gray-200';
                document.getElementById('directMode').style.display = 'block';
                document.getElementById('calculatorMode').style.display = 'none';
            } else {
                directBtn.className = 'flex items-center gap-2 px-4 py-2 rounded-lg transition-colors bg-gray-100 text-gray-700 hover:bg-gray-200';
                calcBtn.className = 'flex items-center gap-2 px-4 py-2 rounded-lg transition-colors bg-pink-500 text-white';
                document.getElementById('directMode').style.display = 'none';
                document.getElementById('calculatorMode').style.display = 'block';
                setupCalculatorMode();
            }
            
            resetScores();
        }

        function setupCalculatorMode() {
            if (calculatorMode !== 'calculator') return;
            
            if (selectedTest === 'PFDI') {
                document.getElementById('pfdiCalculator').style.display = 'block';
                document.getElementById('generalCalculator').style.display = 'none';
                document.getElementById('apfqCalculator').style.display = 'none';
                setupPFDICalculator();
            } else if (selectedTest === 'APFQ') {
                document.getElementById('pfdiCalculator').style.display = 'none';
                document.getElementById('generalCalculator').style.display = 'none';
                document.getElementById('apfqCalculator').style.display = 'block';
                setupAPFQCalculator();
            } else {
                document.getElementById('pfdiCalculator').style.display = 'none';
                document.getElementById('generalCalculator').style.display = 'block';
                document.getElementById('apfqCalculator').style.display = 'none';
                setupGeneralCalculator();
            }
        }

        function setupPFDICalculator() {
            // Setup POPDI-6 questions (1-6)
            const popdiContainer = document.getElementById('popdiQuestions');
            popdiContainer.innerHTML = '';
            for (let i = 1; i <= 6; i++) {
                popdiContainer.appendChild(createQuestionInput(i));
            }
            
            // Setup CRADI-8 questions (7-14)
            const cradiContainer = document.getElementById('cradiQuestions');
            cradiContainer.innerHTML = '';
            for (let i = 7; i <= 14; i++) {
                cradiContainer.appendChild(createQuestionInput(i));
            }
            
            // Setup UDI-6 questions (15-20)
            const udiContainer = document.getElementById('udiQuestions');
            udiContainer.innerHTML = '';
            for (let i = 15; i <= 20; i++) {
                udiContainer.appendChild(createQuestionInput(i));
            }
        }

        function setupAPFQCalculator() {
            // Setup Bladder questions (1-15)
            const bladderContainer = document.getElementById('bladderQuestions');
            bladderContainer.innerHTML = '';
            for (let i = 1; i <= 15; i++) {
                bladderContainer.appendChild(createQuestionInput(i));
            }
            
            // Setup Bowel questions (16-27)
            const bowelContainer = document.getElementById('bowelQuestions');
            bowelContainer.innerHTML = '';
            for (let i = 16; i <= 27; i++) {
                bowelContainer.appendChild(createQuestionInput(i));
            }
            
            // Setup Prolapse questions (28-32)
            const prolapseContainer = document.getElementById('prolapseQuestions');
            prolapseContainer.innerHTML = '';
            for (let i = 28; i <= 32; i++) {
                prolapseContainer.appendChild(createQuestionInput(i));
            }
            
            // Setup Sexual screening questions (33-34) - not scored
            const sexualScreeningContainer = document.getElementById('sexualScreeningQuestions');
            sexualScreeningContainer.innerHTML = '';
            for (let i = 33; i <= 34; i++) {
                const input = createQuestionInput(i);
                input.className = 'flex flex-col opacity-75';
                sexualScreeningContainer.appendChild(input);
            }
            
            // Setup Sexual scored questions (35-42)
            const sexualContainer = document.getElementById('sexualQuestions');
            sexualContainer.innerHTML = '';
            for (let i = 35; i <= 42; i++) {
                sexualContainer.appendChild(createQuestionInput(i));
            }
        }

        function setupGeneralCalculator() {
            if (!selectedTest) return;
            
            const tool = assessmentTools[selectedTest];
            const container = document.getElementById('questionInputs');
            container.innerHTML = '';
            
            for (let i = 1; i <= tool.questions; i++) {
                container.appendChild(createQuestionInput(i));
            }
        }

        function createQuestionInput(questionNum) {
            const div = document.createElement('div');
            div.className = 'flex flex-col';
            
            const label = document.createElement('label');
            label.className = 'text-xs font-medium text-gray-600 mb-1';
            label.textContent = `Q${questionNum}`;
            
            const input = document.createElement('input');
            input.type = 'number';
            input.id = `q${questionNum}`;
            input.className = 'w-full p-2 border border-gray-300 rounded text-sm text-center';
            input.min = '0';
            if (selectedTest === 'PFDI' || selectedTest === 'APFQ') {
                input.max = '4';
                input.step = '1';
            } else {
                input.step = '0.1';
            }
            input.oninput = () => handleIndividualScoreChange(questionNum, input.value);
            
            div.appendChild(label);
            div.appendChild(input);
            
            return div;
        }

        function handleIndividualScoreChange(questionIndex, value) {
            if (value === '') {
                delete individualScores[questionIndex];
            } else {
                const numValue = parseFloat(value);
                if (!isNaN(numValue)) {
                    individualScores[questionIndex] = numValue;
                }
            }
            
            if (calculatorMode === 'calculator') {
                calculateFromIndividual();
            }
        }

        function calculateFromIndividual() {
            if (selectedTest === 'PFDI') {
                calculatePFDIScore();
            } else if (selectedTest === 'APFQ') {
                calculateAPFQScore();
            } else {
                calculateGeneralScore();
            }
        }

        function calculatePFDIScore() {
            const tool = assessmentTools[selectedTest];
            const subscaleScores = {};
            let totalScore = 0;

            Object.entries(tool.subscales).forEach(([subscaleName, subscale]) => {
                const subscaleQuestions = subscale.questions;
                const answeredScores = subscaleQuestions
                    .map(q => individualScores[q])
                    .filter(score => score !== undefined && score !== null && !isNaN(score) && score !== '');
                
                if (answeredScores.length > 0) {
                    const sum = answeredScores.reduce((total, score) => total + parseFloat(score), 0);
                    const mean = sum / answeredScores.length;
                    const subscaleScore = Math.round((mean * 25) * 10) / 10;
                    subscaleScores[subscaleName] = subscaleScore;
                    totalScore += subscaleScore;
                } else {
                    subscaleScores[subscaleName] = 0;
                }
            });

            // Update display
            document.getElementById('popdiScore').textContent = subscaleScores['POPDI-6']?.toFixed(1) || '0.0';
            document.getElementById('cradiScore').textContent = subscaleScores['CRADI-8']?.toFixed(1) || '0.0';
            document.getElementById('udiScore').textContent = subscaleScores['UDI-6']?.toFixed(1) || '0.0';
            document.getElementById('pfdiTotalScore').textContent = totalScore.toFixed(1);

            // Calculate result
            const result = tool.interpretation(totalScore);
            result.subscales = subscaleScores;
            result.totalScore = totalScore;
            currentResult = result;
            showResults();
        }

        function calculateAPFQScore() {
            const tool = assessmentTools[selectedTest];
            const domainScores = {};
            let totalScore = 0;

            Object.entries(tool.domains).forEach(([domainName, domain]) => {
                const domainQuestions = domain.questions;
                const answeredScores = domainQuestions
                    .map(q => individualScores[q])
                    .filter(score => score !== undefined && score !== null && !isNaN(score) && score !== '');
                
                if (answeredScores.length > 0) {
                    // For APFQ, we use raw sum, not normalized scores
                    const sum = answeredScores.reduce((total, score) => total + parseFloat(score), 0);
                    domainScores[domainName] = sum;
                    totalScore += sum;
                } else {
                    domainScores[domainName] = 0;
                }
            });

            // Update display
            document.getElementById('bladderScore').textContent = domainScores['Bladder'] || 0;
            document.getElementById('bowelScore').textContent = domainScores['Bowel'] || 0;
            document.getElementById('prolapseScore').textContent = domainScores['Prolapse'] || 0;
            document.getElementById('sexualScore').textContent = domainScores['Sexual'] || 0;
            document.getElementById('apfqTotalScore').textContent = totalScore + '/115';

            // Calculate result
            const result = tool.interpretation(totalScore);
            result.domains = domainScores;
            result.totalScore = totalScore;
            currentResult = result;
            showResults();
        }

        function calculateGeneralScore() {
            const total = Object.values(individualScores).reduce((sum, score) => sum + (score || 0), 0);
            document.getElementById('generalTotalScore').textContent = total.toFixed(1);
            
            if (selectedTest) {
                const tool = assessmentTools[selectedTest];
                if (total >= tool.minScore && total <= tool.maxScore) {
                    const result = tool.interpretation(total);
                    result.totalScore = total;
                    currentResult = result;
                    showResults();
                } else {
                    showValidationError();
                }
            }
        }

        function calculateResult() {
            const totalInput = document.getElementById('totalScore');
            const score = parseFloat(totalInput.value);
            
            if (selectedTest && !isNaN(score)) {
                const tool = assessmentTools[selectedTest];
                if (score >= tool.minScore && score <= tool.maxScore) {
                    const result = tool.interpretation(score);
                    result.totalScore = score;
                    currentResult = result;
                    showResults();
                    hideValidationError();
                } else {
                    showValidationError();
                }
            } else {
                hideResults();
                hideValidationError();
            }
        }

        function showResults() {
            if (!currentResult) return;

            document.getElementById('percentageScore').textContent = `${currentResult.percentage}%`;
            document.getElementById('interpretationLevel').textContent = currentResult.level;
            
            // Update percentage label based on test type
            const percentageLabel = document.getElementById('percentageLabel');
            if (selectedTest === 'FIQL') {
                percentageLabel.textContent = 'Quality of Life Impact';
            } else if (selectedTest === 'FSFI6') {
                percentageLabel.textContent = 'Sexual Function Impact';
            } else if (selectedTest === 'UIQ') {
                percentageLabel.textContent = 'Urinary Incontinence Impact';
            } else {
                percentageLabel.textContent = 'Symptom Severity Level';
            }

            // Show subscale results for PFDI
            if (selectedTest === 'PFDI' && currentResult.subscales) {
                document.getElementById('popdiResult').textContent = currentResult.subscales['POPDI-6']?.toFixed(1) || '0.0';
                document.getElementById('cradiResult').textContent = currentResult.subscales['CRADI-8']?.toFixed(1) || '0.0';
                document.getElementById('udiResult').textContent = currentResult.subscales['UDI-6']?.toFixed(1) || '0.0';
                document.getElementById('subscaleResults').style.display = 'block';
                document.getElementById('domainResults').style.display = 'none';
            } else if (selectedTest === 'APFQ' && currentResult.domains) {
                document.getElementById('bladderResult').textContent = (currentResult.domains['Bladder'] || 0) + '/45';
                document.getElementById('bowelResult').textContent = (currentResult.domains['Bowel'] || 0) + '/34';
                document.getElementById('prolapseResult').textContent = (currentResult.domains['Prolapse'] || 0) + '/15';
                document.getElementById('sexualResult').textContent = (currentResult.domains['Sexual'] || 0) + '/21';
                document.getElementById('domainResults').style.display = 'block';
                document.getElementById('subscaleResults').style.display = 'none';
            } else {
                document.getElementById('subscaleResults').style.display = 'none';
                document.getElementById('domainResults').style.display = 'none';
            }

            document.getElementById('resultsSection').style.display = 'block';
            hideValidationError();
        }

        function hideResults() {
            document.getElementById('resultsSection').style.display = 'none';
        }

        function showValidationError() {
            if (selectedTest) {
                const tool = assessmentTools[selectedTest];
                document.getElementById('validationMessage').textContent = 
                    `Please enter a valid score between ${tool.minScore} and ${tool.maxScore}.`;
            }
            document.getElementById('validationError').style.display = 'block';
            hideResults();
        }

        function hideValidationError() {
            document.getElementById('validationError').style.display = 'none';
        }

        function updateQuickReference() {
            const quickRef = document.getElementById('quickReference');
            
            if (selectedTest === 'APFQ') {
                quickRef.innerHTML = `
                    <p><strong>Minimal dysfunction:</strong> 0-23 points</p>
                    <p><strong>Mild dysfunction:</strong> 24-40 points</p>
                    <p><strong>Moderate dysfunction:</strong> 41-63 points</p>
                    <p><strong>Severe dysfunction:</strong> 64-86 points</p>
                    <p><strong>Very severe dysfunction:</strong> 87-115 points</p>
                    <div class="mt-3 p-3 bg-blue-50 rounded">
                        <p class="text-xs text-blue-800"><strong>Scoring:</strong> Raw sum of all domain scores</p>
                        <p class="text-xs text-blue-800">Bladder (Q1-15, max 45) + Bowel (Q16-27, max 34) + Prolapse (Q28-32, max 15) + Sexual (Q35-42, max 21)</p>
                        <p class="text-xs text-blue-800"><strong>Total range:</strong> 0-115 points</p>
                        <p class="text-xs text-blue-800"><strong>Note:</strong> Q33 & Q34 are screening questions (not scored)</p>
                    </div>
                `;
            } else if (selectedTest === 'PAC-SYM') {
                quickRef.innerHTML = `
                    <p><strong>Minimal symptoms:</strong> 0.0-1.0 points</p>
                    <p><strong>Mild symptoms:</strong> 1.1-2.0 points</p>
                    <p><strong>Moderate symptoms:</strong> 2.1-3.0 points</p>
                    <p><strong>Severe symptoms:</strong> 3.1-4.0 points</p>
                    <div class="mt-3 p-3 bg-blue-50 rounded">
                        <p class="text-xs text-blue-800"><strong>Note:</strong> Mean score calculated from 12 items (0-4 scale)</p>
                    </div>
                `;
            } else if (selectedTest === 'FIQL') {
                quickRef.innerHTML = `
                    <p><strong>Excellent QoL:</strong> 3.41-4.0 points</p>
                    <p><strong>Good QoL:</strong> 2.81-3.40 points</p>
                    <p><strong>Fair QoL:</strong> 2.21-2.80 points</p>
                    <p><strong>Poor QoL:</strong> 1.61-2.20 points</p>
                    <p><strong>Very poor QoL:</strong> 1.0-1.60 points</p>
                    <div class="mt-3 p-3 bg-blue-50 rounded">
                        <p class="text-xs text-blue-800"><strong>Note:</strong> Mean score from 29 items; lower scores = worse quality of life</p>
                    </div>
                `;
            } else if (selectedTest === 'MENQOL') {
                quickRef.innerHTML = `
                    <p><strong>Minimal symptoms:</strong> 1.0-2.4 points</p>
                    <p><strong>Mild symptoms:</strong> 2.5-3.8 points</p>
                    <p><strong>Moderate symptoms:</strong> 3.9-5.2 points</p>
                    <p><strong>Severe symptoms:</strong> 5.3-6.6 points</p>
                    <p><strong>Very severe symptoms:</strong> 6.7-8.0 points</p>
                    <div class="mt-3 p-3 bg-blue-50 rounded">
                        <p class="text-xs text-blue-800"><strong>Note:</strong> Mean score from 29 items (1-8 scale); higher scores = more bothersome</p>
                    </div>
                `;
            } else if (selectedTest === 'FSFI6') {
                quickRef.innerHTML = `
                    <p><strong>Normal function:</strong> 19-30 points</p>
                    <p><strong>Mild dysfunction:</strong> 15-18 points</p>
                    <p><strong>Moderate dysfunction:</strong> 10-14 points</p>
                    <p><strong>Severe dysfunction:</strong> 2-9 points</p>
                    <div class="mt-3 p-3 bg-blue-50 rounded">
                        <p class="text-xs text-blue-800"><strong>Note:</strong> Cutoff โค19 indicates likely sexual dysfunction</p>
                    </div>
                `;
            } else if (selectedTest === 'PFDI') {
                quickRef.innerHTML = `
                    <p><strong>Minimal disability:</strong> 0-30 points</p>
                    <p><strong>Mild disability:</strong> 31-90 points</p>
                    <p><strong>Moderate disability:</strong> 91-150 points</p>
                    <p><strong>Severe disability:</strong> 151-210 points</p>
                    <p><strong>Very severe disability:</strong> 211-300 points</p>
                    <div class="mt-3 p-3 bg-blue-50 rounded">
                        <p class="text-xs text-blue-800"><strong>Scoring:</strong> Mean of answered items ร 25 for each subscale, then sum all subscales</p>
                        <p class="text-xs text-blue-800">POPDI-6 (Q1-6) + CRADI-8 (Q7-14) + UDI-6 (Q15-20)</p>
                    </div>
                `;
            } else if (selectedTest === 'UIQ') {
                quickRef.innerHTML = `
                    <p><strong>Minimal impact:</strong> 0-9 points</p>
                    <p><strong>Mild impact:</strong> 10-23 points</p>
                    <p><strong>Moderate impact:</strong> 24-45 points</p>
                    <p><strong>Severe impact:</strong> 46-68 points</p>
                    <p><strong>Very severe impact:</strong> 69-91 points</p>
                `;
            } else {
                quickRef.innerHTML = `
                    <p><strong>Minimal Impairment:</strong> 0-20%</p>
                    <p><strong>Mild Impairment:</strong> 21-40%</p>
                    <p><strong>Moderate Impairment:</strong> 41-60%</p>
                    <p><strong>Severe Impairment:</strong> 61-80%</p>
                    <p><strong>Very Severe Impairment:</strong> 81-100%</p>
                `;
            }
        }

        function resetScores() {
            individualScores = {};
            currentResult = null;
            
            // Clear all input fields
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => input.value = '');
            
            // Reset PFDI display scores
            document.getElementById('popdiScore').textContent = '0.0';
            document.getElementById('cradiScore').textContent = '0.0';
            document.getElementById('udiScore').textContent = '0.0';
            document.getElementById('pfdiTotalScore').textContent = '0.0';
            
            // Reset APFQ display scores
            document.getElementById('bladderScore').textContent = '0';
            document.getElementById('bowelScore').textContent = '0';
            document.getElementById('prolapseScore').textContent = '0';
            document.getElementById('sexualScore').textContent = '0';
            document.getElementById('apfqTotalScore').textContent = '0/115';
            
            document.getElementById('generalTotalScore').textContent = '0.0';
            
            hideResults();
            hideValidationError();
        }

        function resetCalculator() {
            selectedTest = '';
            calculatorMode = 'direct';
            
            document.getElementById('testSelector').value = '';
            hideTestInfo();
            hideCalculatorSection();
            
            // Reset mode buttons
            setCalculatorMode('direct');
            
            resetScores();
            
            // Reset quick reference to default
            const quickRef = document.getElementById('quickReference');
            quickRef.innerHTML = `
                <p><strong>Minimal Impairment:</strong> 0-20%</p>
                <p><strong>Mild Impairment:</strong> 21-40%</p>
                <p><strong>Moderate Impairment:</strong> 41-60%</p>
                <p><strong>Severe Impairment:</strong> 61-80%</p>
                <p><strong>Very Severe Impairment:</strong> 81-100%</p>
            `;
        }

        // Initialize calculator
        setCalculatorMode('direct');
    </script>
</body>
</html>
